<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>W1ndy Checkers</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        body {
            background: #0a2f44;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            padding: 10px;
            position: relative;
            transition: background-color 0.3s ease;
        }

        /* –ª–µ–≥–∫–∏–π —Å–Ω–µ–∂–æ–∫ */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            background: radial-gradient(circle at 10% 20%, rgba(255,255,255,0.05) 1px, transparent 1px),
                        radial-gradient(circle at 90% 70%, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 200px 200px;
            animation: snowFloat 10s linear infinite;
            z-index: 0;
        }

        @keyframes snowFloat {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 200px 200px, 150px 150px; }
        }

        .game-window {
            max-width: 1200px;
            width: 100%;
            background: #f3e5d5;
            border-radius: 50px 50px 40px 40px;
            padding: 20px 15px 20px 15px;
            box-shadow: 0 20px 30px rgba(0, 0, 0, 0.7), inset 2px 2px 8px #fff6e5;
            border: 3px solid #c9a86b;
            position: relative;
            z-index: 10;
            transition: filter 0.3s ease, background-color 0.3s ease;
        }

        .title-block {
            display: flex;
            flex-direction: column;
        }
        .main-title {
            font-size: 2.2rem;
            font-weight: 800;
            color: #1f3a2d;
            text-shadow: 3px 3px 0 #d4b48c;
            letter-spacing: 1px;
            line-height: 1;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 5px;
        }

        .settings-btn {
            background: #c52b2b;
            border: none;
            color: #ffecb3;
            font-size: 2rem;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: inset 0 -4px 0 #771e1e, 0 6px 0 #3d1e1e;
            border: 2px solid #ffd966;
            transition: 0.1s linear;
        }
        .settings-btn:active {
            transform: translateY(5px);
            box-shadow: inset 0 -1px 0 #771e1e, 0 3px 0 #3d1e1e;
        }

        .play-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .board-wrapper {
            background: #6b4f3a;
            padding: 15px 15px 12px 15px;
            border-radius: 40px;
            box-shadow: inset 0 0 0 3px #b49473, 0 15px 15px -8px #1f1a15;
            width: 100%;
            max-width: 500px;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            aspect-ratio: 1/1;
            width: 100%;
            background: #e2c7a7;
            border: 4px solid #936f4f;
            border-radius: 20px;
            overflow: hidden;
        }
        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .cell.dark {
            background-color: #7b5d41;
        }
        .cell.light {
            background-color: #efdbbc;
        }
        .cell.dark.possible-move {
            background-color: #5b8c4e;
            box-shadow: inset 0 0 0 4px #fffbc2;
            transform: scale(0.95);
        }
        .checker {
            width: 75%;
            height: 75%;
            border-radius: 50%;
            box-shadow: 0 5px 0 #392e24, 0 6px 8px black;
            transition: all 0.2s ease;
            border: 2px solid #44382c;
        }
        .checker.white {
            background: radial-gradient(circle at 35% 35%, #fefefe, #c0c0c0);
            border: 2px solid #f0e2d1;
            box-shadow: 0 4px 0 #5f5346, 0 6px 10px #1f1b16;
        }
        .checker.black {
            background: radial-gradient(circle at 35% 35%, #4d4d5c, #1e1e24);
            border: 2px solid #b4a087;
            box-shadow: 0 4px 0 #2b231e, 0 6px 10px black;
        }
        .cell.selected .checker {
            transform: scale(1.1) rotate(5deg);
            filter: brightness(1.3);
            box-shadow: 0 0 25px #fff0a0;
        }

        .control-panel {
            background: #2f241d;
            border-radius: 50px;
            padding: 25px 20px;
            width: 100%;
            max-width: 500px;
            box-shadow: inset 0 2px 8px #a08368, 0 15px 15px -5px #0e0b08;
            border: 2px solid #c9a86b;
        }

        .game-controls h2,
        .stats-section h2 {
            color: #fae1cb;
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 15px;
            border-bottom: 3px dashed #e6b422;
            padding-bottom: 5px;
            letter-spacing: 0.5px;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-btn {
            background: #4d3b2d;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 700;
            color: #f3e2d3;
            text-align: left;
            padding-left: 25px;
            box-shadow: inset 0 -4px 0 #2b1e16, 0 5px 0 #18130f;
            border: 1px solid #b49274;
            cursor: pointer;
            transition: all 0.1s linear;
            letter-spacing: 0.5px;
        }
        .action-btn.small {
            font-size: 1.2rem;
            padding: 12px 20px;
        }
        .action-btn:active {
            transform: translateY(4px);
            box-shadow: inset 0 -1px 0 #2b1e16, 0 2px 0 #18130f;
        }

        .stats-section {
            margin-top: 25px;
        }
        .stats-cards {
            background: #392e26;
            border-radius: 40px;
            padding: 15px 18px;
            border: 2px solid #8b7059;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 2px solid #6b533f;
            font-size: 1.3rem;
            font-weight: 600;
        }
        .stat-row:last-child {
            border-bottom: none;
        }
        .stat-label {
            color: #f1d9c0;
        }
        .stat-value {
            background: #1f1914;
            padding: 5px 22px;
            border-radius: 50px;
            color: #ffdbb2;
            font-size: 1.4rem;
            font-weight: 700;
        }

        /* –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            visibility: hidden;
            opacity: 0;
            transition: 0.2s;
            backdrop-filter: blur(5px);
            padding: 15px;
        }
        .modal-overlay.show {
            visibility: visible;
            opacity: 1;
        }
        .settings-modal {
            background: #2f241d;
            width: 100%;
            max-width: 400px;
            border-radius: 60px;
            padding: 30px 25px;
            border: 4px solid #d4a85f;
            box-shadow: 0 30px 50px black;
        }
        .settings-modal h2 {
            color: #fae1cb;
            font-size: 2rem;
            margin-bottom: 20px;
            border-bottom: 3px dashed #e6b422;
            padding-bottom: 8px;
            text-align: center;
        }
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            color: #f1d9c0;
            font-size: 1.4rem;
            font-weight: 600;
            flex-wrap: wrap;
            gap: 10px;
        }
        .setting-item span:first-child {
            min-width: 100px;
        }
        .setting-item input[type="range"] {
            flex: 1;
            min-width: 150px;
            height: 12px;
            background: #4d3b2d;
            border-radius: 20px;
            -webkit-appearance: none;
        }
        .setting-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            background: #e62222;
            border-radius: 50%;
            border: 3px solid #ffd966;
            cursor: pointer;
        }
        .close-modal {
            background: #c52b2b;
            border: none;
            padding: 16px 30px;
            border-radius: 50px;
            color: #ffecb3;
            font-size: 1.4rem;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            box-shadow: inset 0 -4px 0 #771e1e, 0 5px 0 #3d1e1e;
            border: 2px solid #ffd966;
            margin-top: 15px;
        }
        .close-modal:active {
            transform: translateY(4px);
            box-shadow: inset 0 -1px 0 #771e1e, 0 2px 0 #3d1e1e;
        }
        .channel-link {
            display: block;
            text-align: center;
            background: #4d3b2d;
            color: #fae1cb;
            text-decoration: none;
            font-size: 1.4rem;
            padding: 14px;
            border-radius: 50px;
            border: 2px solid #d4a85f;
            margin: 20px 0 10px;
            transition: 0.1s;
            font-weight: 600;
        }
        .channel-link:active {
            transform: scale(0.97);
        }
    </style>
</head>
<body>
    <div class="game-window" id="gameWindow">
        <!-- —à–∞–ø–∫–∞ -->
        <div class="top-bar">
            <div class="title-block">
                <div class="main-title">W1ndy Checkers</div>
            </div>
            <button class="settings-btn" id="settingsBtn">‚öôÔ∏è</button>
        </div>

        <!-- –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ + –ø–∞–Ω–µ–ª—å -->
        <div class="play-area">
            <div class="board-wrapper">
                <div id="checkerBoard" class="board"></div>
            </div>

            <!-- –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="control-panel">
                <div class="game-controls">
                    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π</h2>
                    <div class="button-group">
                        <button class="action-btn" id="startGameBtn">‚ñ∂ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                        <button class="action-btn" id="resetBoardBtn">‚Ü∫ –ó–∞–Ω–æ–≤–æ</button>
                        <button class="action-btn small" id="hintBtn">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
                        <button class="action-btn small" id="undoBtn">‚Ü∂ –û—Ç–º–µ–Ω–∏—Ç—å —Ö–æ–¥</button>
                    </div>
                </div>
                
                <!-- –¢–û–õ–¨–ö–û –ü–û–ë–ï–î–´ -->
                <div class="stats-section">
                    <h2>–ü–æ–±–µ–¥—ã</h2>
                    <div class="stats-cards">
                        <div class="stat-row">
                            <span class="stat-label">‚ö™ –ë–µ–ª—ã–µ</span>
                            <span class="stat-value" id="whiteScoreDisplay">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">‚ö´ –ß–µ—Ä–Ω—ã–µ</span>
                            <span class="stat-value" id="blackScoreDisplay">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="modal-overlay" id="settingsModal">
        <div class="settings-modal">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            <div class="setting-item">
                <span>üîä –ó–≤—É–∫</span>
                <input type="range" min="0" max="100" value="70" id="soundRange">
            </div>
            <div class="setting-item">
                <span>‚òÄÔ∏è –Ø—Ä–∫–æ—Å—Ç—å</span>
                <input type="range" min="30" max="100" value="90" id="brightnessRange">
            </div>
            <div class="setting-item">
                <span>‚ú® –ê–Ω–∏–º–∞—Ü–∏—è</span>
                <input type="range" min="0" max="100" value="100" id="animationRange">
            </div>
            <a class="channel-link" href="https://t.me/checkersbyw1ndy" target="_blank">üì¢ –ù–∞—à –∫–∞–Ω–∞–ª</a>
            <button class="close-modal" id="closeSettingsBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- –∞—É–¥–∏–æ -->
    <audio id="bgMusic" loop preload="auto" style="display:none">
        <source src="sounds/background.mp3" type="audio/mpeg">
    </audio>

    <script>
        (function() {
            const boardEl = document.getElementById('checkerBoard');
            const whiteSpan = document.getElementById('whiteScoreDisplay');
            const blackSpan = document.getElementById('blackScoreDisplay');

            let board = [];
            let currentPlayer = 1;
            let selectedRow = -1, selectedCol = -1;
            let possibleTargets = [];
            
            let whiteWins = 0, blackWins = 0;
            let historyStack = [];

            // –ê—É–¥–∏–æ
            let audioCtx = null;
            let soundEnabled = true;
            let soundVolume = 0.7;

            const bgMusic = document.getElementById('bgMusic');
            bgMusic.volume = 0.3;

            function initAudio() {
                if (audioCtx) return;
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }

            function playMoveSound() {
                if (!soundEnabled || !audioCtx) return;
                
                const now = audioCtx.currentTime;
                const osc = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                osc.type = 'sine';
                osc.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.08 * soundVolume, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.08);
                
                osc.connect(gainNode).connect(audioCtx.destination);
                osc.start(now);
                osc.stop(now + 0.08);
            }

            function playCaptureSound() {
                if (!soundEnabled || !audioCtx) return;
                
                const now = audioCtx.currentTime;
                const osc1 = audioCtx.createOscillator();
                const osc2 = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                osc1.type = 'triangle';
                osc1.frequency.value = 400;
                osc2.type = 'triangle';
                osc2.frequency.value = 300;
                
                gainNode.gain.setValueAtTime(0.12 * soundVolume, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                
                osc1.connect(gainNode);
                osc2.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                osc1.start(now);
                osc2.start(now);
                osc1.stop(now + 0.15);
                osc2.stop(now + 0.15);
            }

            function createInitialBoard() {
                const newBoard = Array(8).fill().map(() => Array(8).fill(0));
                for (let r = 0; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        if ((r + c) % 2 === 1) {
                            if (r < 3) newBoard[r][c] = 2;
                            else if (r > 4) newBoard[r][c] = 1;
                        }
                    }
                }
                return newBoard;
            }

            function saveToHistory() {
                historyStack.push({
                    board: board.map(row => [...row]),
                    currentPlayer: currentPlayer
                });
            }

            function undoLast() {
                if (historyStack.length === 0) return;
                const prev = historyStack.pop();
                board = prev.board.map(row => [...row]);
                currentPlayer = prev.currentPlayer;
                selectedRow = -1; selectedCol = -1;
                possibleTargets = [];
                renderBoard();
            }

            function getCaptureMoves(row, col, player) {
                const moves = [];
                const opponent = player === 1 ? 2 : 1;
                const dirs = [[-1,-1], [-1,1], [1,-1], [1,1]];
                for (let [dr, dc] of dirs) {
                    const midR = row + dr, midC = col + dc;
                    const landR = row + 2*dr, landC = col + 2*dc;
                    if (landR>=0 && landR<8 && landC>=0 && landC<8) {
                        if (board[midR] && board[midR][midC] === opponent && board[landR][landC] === 0) {
                            moves.push({ row: landR, col: landC, captureRow: midR, captureCol: midC });
                        }
                    }
                }
                return moves;
            }

            function getSimpleMoves(row, col, player) {
                const moves = [];
                const dir = player === 1 ? -1 : 1;
                const newR = row + dir;
                if (newR < 0 || newR >= 8) return moves;
                if (col-1 >= 0 && board[newR][col-1] === 0) {
                    moves.push({ row: newR, col: col-1, captureRow: -1, captureCol: -1 });
                }
                if (col+1 < 8 && board[newR][col+1] === 0) {
                    moves.push({ row: newR, col: col+1, captureRow: -1, captureCol: -1 });
                }
                return moves;
            }

            function getAllMovesForPiece(row, col, player) {
                if (board[row][col] !== player) return [];
                const captures = getCaptureMoves(row, col, player);
                const simples = getSimpleMoves(row, col, player);
                return [...captures, ...simples];
            }

            function getWinner() {
                let whiteExists = false, blackExists = false;
                for (let r = 0; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        if (board[r][c] === 1) whiteExists = true;
                        else if (board[r][c] === 2) blackExists = true;
                    }
                }
                if (!whiteExists) return 2;
                if (!blackExists) return 1;
                return 0;
            }

            function handleBoardClick(row, col) {
                const winner = getWinner();
                if (winner !== 0) return;

                if (selectedRow !== -1 && possibleTargets.some(t => t.row === row && t.col === col)) {
                    const move = possibleTargets.find(t => t.row === row && t.col === col);
                    saveToHistory();

                    if (move.captureRow !== -1) {
                        playCaptureSound();
                    } else {
                        playMoveSound();
                    }

                    board[row][col] = board[selectedRow][selectedCol];
                    board[selectedRow][selectedCol] = 0;

                    if (move.captureRow !== -1) {
                        board[move.captureRow][move.captureCol] = 0;
                    }

                    selectedRow = -1; selectedCol = -1;
                    possibleTargets = [];

                    const gameWinner = getWinner();
                    if (gameWinner === 1) {
                        whiteWins++;
                        whiteSpan.innerText = whiteWins;
                    } else if (gameWinner === 2) {
                        blackWins++;
                        blackSpan.innerText = blackWins;
                    } else {
                        currentPlayer = currentPlayer === 1 ? 2 : 1;
                    }

                    renderBoard();
                    return;
                }

                if (board[row][col] === currentPlayer) {
                    selectedRow = row;
                    selectedCol = col;
                    const moves = getAllMovesForPiece(row, col, currentPlayer);
                    possibleTargets = moves.map(m => ({
                        row: m.row,
                        col: m.col,
                        captureRow: m.captureRow !== undefined ? m.captureRow : -1,
                        captureCol: m.captureCol !== undefined ? m.captureCol : -1
                    }));
                    renderBoard();
                    return;
                }

                selectedRow = -1; selectedCol = -1;
                possibleTargets = [];
                renderBoard();
            }

            function renderBoard() {
                boardEl.innerHTML = '';
                for (let r = 0; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        const cell = document.createElement('div');
                        cell.className = `cell ${(r + c) % 2 === 1 ? 'dark' : 'light'}`;
                        cell.setAttribute('data-row', r);
                        cell.setAttribute('data-col', c);

                        if (possibleTargets.some(t => t.row === r && t.col === c)) {
                            cell.classList.add('possible-move');
                        }
                        if (selectedRow === r && selectedCol === c) {
                            cell.classList.add('selected');
                        }

                        if (board[r][c] !== 0) {
                            const piece = document.createElement('div');
                            piece.className = `checker ${board[r][c] === 1 ? 'white' : 'black'}`;
                            cell.appendChild(piece);
                        }

                        cell.addEventListener('click', (function(row, col) {
                            return function() { handleBoardClick(row, col); };
                        })(r, c));

                        boardEl.appendChild(cell);
                    }
                }
            }

            function newGame() {
                board = createInitialBoard();
                currentPlayer = 1;
                selectedRow = -1; selectedCol = -1;
                possibleTargets = [];
                historyStack = [];
                renderBoard();
            }

            function restartGame() {
                board = createInitialBoard();
                currentPlayer = 1;
                selectedRow = -1; selectedCol = -1;
                possibleTargets = [];
                historyStack = [];
                renderBoard();
            }

            function showHint() {
                for (let r = 0; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        if (board[r][c] === currentPlayer) {
                            const moves = getAllMovesForPiece(r, c, currentPlayer);
                            if (moves.length > 0) {
                                selectedRow = r;
                                selectedCol = c;
                                possibleTargets = moves.map(m => ({
                                    row: m.row,
                                    col: m.col,
                                    captureRow: m.captureRow !== undefined ? m.captureRow : -1,
                                    captureCol: m.captureCol !== undefined ? m.captureCol : -1
                                }));
                                renderBoard();
                                return;
                            }
                        }
                    }
                }
            }

            document.getElementById('startGameBtn').addEventListener('click', newGame);
            document.getElementById('resetBoardBtn').addEventListener('click', restartGame);
            document.getElementById('hintBtn').addEventListener('click', showHint);
            document.getElementById('undoBtn').addEventListener('click', undoLast);

            const modal = document.getElementById('settingsModal');
            const settingsBtn = document.getElementById('settingsBtn');
            const closeBtn = document.getElementById('closeSettingsBtn');

            settingsBtn.addEventListener('click', () => {
                modal.classList.add('show');
            });

            closeBtn.addEventListener('click', () => {
                modal.classList.remove('show');
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('show');
                }
            });

            const soundRange = document.getElementById('soundRange');
            const brightnessRange = document.getElementById('brightnessRange');
            const animationRange = document.getElementById('animationRange');
            const gameWindow = document.getElementById('gameWindow');

            function startAllAudio() {
                initAudio();
                bgMusic.play().catch(e => console.log('music play delayed'));
                document.removeEventListener('click', startAllAudio);
            }
            document.addEventListener('click', startAllAudio, { once: true });

            soundRange.addEventListener('input', (e) => {
                const val = parseInt(e.target.value) / 100;
                soundVolume = val;
                soundEnabled = val > 0;
            });

            brightnessRange.addEventListener('input', (e) => {
                const val = parseInt(e.target.value);
                document.body.style.backgroundColor = `hsl(210, 50%, ${10 + val * 0.3}%)`;
                gameWindow.style.filter = `brightness(${val / 100 + 0.5})`;
            });

            animationRange.addEventListener('input', (e) => {
                const val = parseInt(e.target.value);
                const speed = 0.2 * (100 / val);
                document.querySelectorAll('.cell, .checker').forEach(el => {
                    el.style.transitionDuration = `${Math.max(0.05, speed)}s`;
                });
            });

            board = createInitialBoard();
            renderBoard();
            whiteSpan.innerText = whiteWins;
            blackSpan.innerText = blackWins;
        })();
    </script>
</body>
</html>
